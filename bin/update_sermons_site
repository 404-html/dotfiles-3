#!/usr/bin/env python3

from os.path import expanduser
import frontmatter
import os
import glob
import dateutil.parser

home = expanduser("~")

worship_sermons_path = (home + '/Sites/church_site_2014/worship/_posts/*.markdown')
worship_posts = glob.glob(worship_sermons_path)

for post in worship_posts:
	os.remove(post)

path = (home + '/Next/Administration/Markdown_Files/Sermon_Work/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9]*sermon.md')
files = glob.glob(path)

for name in files:
	post = frontmatter.load(name)
	scripture = post['scripture'] 
	title = post['title'] 
	speaker = post['author']
	date = dateutil.parser.parse(post['date']).strftime('%Y-%m-%d')
	description = post['summary']
	title_sliced = title.split()
	slug = ("-".join(title_sliced).lower())
	filename =(home + '/Sites/church_site_2014/worship/_posts/' + date + '-' + slug + '.markdown')

	target = open (filename, 'w')
	target.write("---\n")
	target.write("author: {}\n".format(speaker))
	target.write("title: {}\n".format(title))
	target.write("scripture: {}\n".format(scripture))
	target.write("date: {}\n".format(date))
	target.write("layout: worship\n")
	target.write("---\n")
	target.write("\n")
	target.write(description)
	target.write("\n")
	target.close()
